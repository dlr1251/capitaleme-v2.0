---
import Layout from "../../../layouts/Layout.astro";
import { getAllContentData } from '../../../server/lib/contentData.js';
import { BookOpenIcon, ClockIcon, UserIcon, CalendarIcon, ArrowRightIcon, StarIcon, SparklesIcon } from '@heroicons/react/24/outline';

const lang = 'en';
const menuData = await getAllContentData(lang);

// Get guides data from menuData
const allGuides = menuData?.allGuides || [];

// Filter published guides
const publishedGuides = allGuides.filter((guide: any) => guide.isPublished !== false);

// Get featured guides
const featuredGuides = publishedGuides.filter((guide: any) => guide.isFeatured).slice(0, 3);

// Get categories
const categories = [...new Set(publishedGuides.map((guide: any) => guide.category).filter(Boolean))].sort();

// Calculate reading time (rough estimate: 200 words per minute)
const calculateReadingTime = (text: string) => {
  const words = text.split(' ').length;
  const minutes = Math.ceil(words / 200);
  return minutes;
};

// Format date function
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
};

// Get relative time
const getRelativeTime = (dateString: string) => {
  try {
    const date = new Date(dateString);
    const now = new Date();
    
    // Check if date is valid
    if (isNaN(date.getTime())) {
      return 'Recently';
    }
    
    const diffInDays = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));
    
    if (diffInDays === 0) return 'Today';
    if (diffInDays === 1) return 'Yesterday';
    if (diffInDays < 7) return `${diffInDays} days ago`;
    if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;
    if (diffInDays < 365) return `${Math.floor(diffInDays / 30)} months ago`;
    return `${Math.floor(diffInDays / 365)} years ago`;
  } catch (error) {
    return 'Recently';
  }
};
---

<Layout title="Legal Guides - Capital M Law | Colombian Legal Services" lang={lang} menuData={menuData}>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 py-20">
    <div class="absolute inset-0 bg-grid-slate-100 [mask-image:linear-gradient(0deg,white,rgba(255,255,255,0.6))] -z-10"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-6">
          <BookOpenIcon className="w-8 h-8 text-blue-600" />
        </div>
        <h1 class="text-4xl md:text-6xl font-bold text-slate-900 mb-6">
          Legal Guides
        </h1>
        <p class="text-xl text-slate-600 max-w-3xl mx-auto leading-relaxed mb-8">
          Step-by-step guides and essential resources to navigate legal processes in Colombia. 
          Expert insights from our bilingual legal team.
        </p>
        <div class="flex items-center justify-center space-x-6 text-sm text-slate-500">
          <span class="flex items-center">
            <ClockIcon className="w-4 h-4 mr-1" />
            {publishedGuides.length} guides available
          </span>
          <span class="flex items-center">
            <SparklesIcon className="w-4 h-4 mr-1" />
            Expert curated
          </span>
          <span class="flex items-center">
            <StarIcon className="w-4 h-4 mr-1" />
            Regularly updated
          </span>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Guides Section -->
  {featuredGuides.length > 0 && (
    <section class="py-16 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-slate-900 mb-4">Featured Guides</h2>
          <p class="text-lg text-slate-600">Our most popular and comprehensive legal resources</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {featuredGuides.map((guide: any, index: number) => {
            const readingTime = calculateReadingTime(guide.description || '');
            const isNew = new Date(guide.last_edited || guide.updated_at || '').getTime() > Date.now() - (7 * 24 * 60 * 60 * 1000);
            
            return (
              <article class="group relative bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden">
                {isNew && (
                  <div class="absolute top-4 right-4 z-10">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      New
                    </span>
                  </div>
                )}
                <div class="p-6">
                  <div class="flex items-center justify-between mb-4">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      {guide.category || 'Legal Guide'}
                    </span>
                    <span class="text-xs text-slate-500 flex items-center">
                      <ClockIcon className="w-3 h-3 mr-1" />
                      {readingTime} min read
                    </span>
                  </div>
                  
                  <a class="block group-hover:text-blue-600 transition-colors duration-300" href={`/en/guides/${guide.slug}`}>
                    <h3 class="text-xl font-semibold text-slate-900 mb-3 line-clamp-2 group-hover:text-blue-600 transition-colors duration-300">
                      {guide.title}
                    </h3>
                  </a>
                  
                  <p class="text-slate-600 mb-4 line-clamp-3 text-sm leading-relaxed">
                    {guide.description}
                  </p>
                  
                  <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                    <div class="flex items-center text-sm text-slate-500">
                      <UserIcon className="w-4 h-4 mr-1" />
                      {guide.author || 'Capital M Law'}
                    </div>
                    <div class="flex items-center text-xs text-slate-400">
                      <CalendarIcon className="w-3 h-3 mr-1" />
                      {getRelativeTime(guide.last_edited || guide.updated_at || '')}
                    </div>
                  </div>
                  
                  <div class="mt-4">
                    <a href={`/en/guides/${guide.slug}`} class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium text-sm group-hover:underline transition-all duration-300">
                      Read guide
                      <ArrowRightIcon className="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform duration-300" />
                    </a>
                  </div>
                </div>
              </article>
            );
          })}
        </div>
      </div>
    </section>
  )}

  <!-- All Guides Section -->
  <section class="py-16 bg-slate-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-slate-900 mb-4">All Legal Guides</h2>
        <p class="text-lg text-slate-600">Comprehensive resources for every legal process</p>
      </div>
      
      {publishedGuides.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {publishedGuides.map((guide: any) => {
            const readingTime = calculateReadingTime(guide.description || '');
            const isNew = new Date(guide.last_edited || guide.updated_at || '').getTime() > Date.now() - (7 * 24 * 60 * 60 * 1000);
            const isUpdated = new Date(guide.last_edited || guide.updated_at || '').getTime() > Date.now() - (30 * 24 * 60 * 60 * 1000);
            
            return (
              <article class="group relative bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden">
                {isNew && (
                  <div class="absolute top-4 right-4 z-10">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      New
                    </span>
                  </div>
                )}
                {isUpdated && !isNew && (
                  <div class="absolute top-4 right-4 z-10">
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      Updated
                    </span>
                  </div>
                )}
                <div class="p-6">
                  <div class="flex items-center justify-between mb-4">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-800">
                      {guide.category || 'Legal Guide'}
                    </span>
                    <span class="text-xs text-slate-500 flex items-center">
                      <ClockIcon className="w-3 h-3 mr-1" />
                      {readingTime} min read
                    </span>
                  </div>
                  
                  <a class="block group-hover:text-blue-600 transition-colors duration-300" href={`/en/guides/${guide.slug}`}>
                    <h3 class="text-lg font-semibold text-slate-900 mb-3 line-clamp-2 group-hover:text-blue-600 transition-colors duration-300">
                      {guide.title}
                    </h3>
                  </a>
                  
                  <p class="text-slate-600 mb-4 line-clamp-3 text-sm leading-relaxed">
                    {guide.description}
                  </p>
                  
                  <div class="flex items-center justify-between pt-4 border-t border-slate-100">
                    <div class="flex items-center text-sm text-slate-500">
                      <UserIcon className="w-4 h-4 mr-1" />
                      {guide.author || 'Capital M Law'}
                    </div>
                    <div class="flex items-center text-xs text-slate-400">
                      <CalendarIcon className="w-3 h-3 mr-1" />
                      {getRelativeTime(guide.last_edited || guide.updated_at || '')}
                    </div>
                  </div>
                  
                  <div class="mt-4">
                    <a href={`/en/guides/${guide.slug}`} class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium text-sm group-hover:underline transition-all duration-300">
                      Read guide
                      <ArrowRightIcon className="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform duration-300" />
                    </a>
                  </div>
                </div>
              </article>
            );
          })}
        </div>
      ) : (
        <div class="text-center py-16">
          <div class="max-w-md mx-auto">
            <BookOpenIcon className="w-16 h-16 mx-auto text-slate-400 mb-4" />
            <h3 class="text-lg font-medium text-slate-900 mb-2">No guides available</h3>
            <p class="text-slate-500">We're working on new legal guides. Check back soon for more content.</p>
          </div>
        </div>
      )}
    </div>
  </section>

  <!-- Call to Action -->
  <section class="py-16 bg-gradient-to-r from-blue-50 to-indigo-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl font-bold text-slate-900 mb-4">Need personalized legal help?</h2>
      <p class="text-lg text-slate-600 mb-8">
        Our expert attorneys are here to help you with your legal processes in Colombia. 
        Get personalized guidance for your specific situation.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href="https://calendly.com/capital-m-law/programmed-initial-consultation" 
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300 font-medium"
        >
          <CalendarIcon className="w-5 h-5 mr-2" />
          Book Consultation
        </a>
        <a 
          href="/en/contact" 
          class="inline-flex items-center justify-center px-6 py-3 border border-slate-300 text-slate-700 bg-white rounded-lg hover:bg-slate-50 transition-colors duration-300 font-medium"
        >
          Contact Us
        </a>
      </div>
    </div>
  </section>
</Layout> 